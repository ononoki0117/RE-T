<!DOCTYPE html>
<html lang="en">

<head>
    <%- include("../../component/component.head.html") %>
        <title>RE:T main</title>

        <link rel="stylesheet" href="/style/main/style.css">

</head>

<body class="screen-1">

    <div>
        <%- include('../../component/component.header.ejs') %>
    </div>

    <div>
        <%- include('../../component/component.calendar.weekly.ejs') %>
    </div>

    <br>

    <div class="ret_percent">
        <%- include('../../component/component.exercise.progress.ejs') %>
    </div>

    <div class="select">
        <%- include('../../component/component.main.select.ejs', {select : 2}) %>
    </div>

    <h5 id="today_ret">오늘의 재활일기</h5>

    <p class="heart">통증정도</p>

    <form method="post" action="/patient/diary">

        <div class="heart_gauge" role="progressbar" aria-label="Basic example" aria-valuenow="25" aria-valuemin="0"
            aria-valuemax="100">
            <div class="heart_bar" style="width: 50%"></div>
        </div>
        <input type="hidden" id="sliderValue" name="sliderValue" value="50">

        <p class="heart">재활운동 TODO LIST</p>
        <div class="todo">
            <% data.exercises.forEach(exercise=> { %>
                <div class="my_work">
                    <p class="my_work_font">
                        <%=exercise.name%>
                    </p>
                    <% if (exercise.complete) { %>
                        <div class="com toggle"></div>
                        <% } else { %>
                            <div class="uncom toggle"></div>
                            <% } %>
                </div>
                <% }) %>
        </div>

        <p class="heart">기록하기</p>

        <textarea class="diary" placeholder=" 재활운동 후 느낀점 및 구체적 통증을 기록해주세요 |"> </textarea>

        <button class="login">저장하기 </button>
    </form>

    <script>
        const heartGauge = document.querySelector('.heart_gauge');
        const heartBar = document.querySelector('.heart_bar');
        const sliderValueInput = document.getElementById('sliderValue');

        heartBar.addEventListener('mousedown', (event) => {
            const onMouseMove = (event) => {
                const gaugeRect = heartGauge.getBoundingClientRect();
                let newWidth = (event.clientX - gaugeRect.left) / gaugeRect.width * 100;


                if (newWidth < 0) newWidth = 0;
                if (newWidth > 100) newWidth = 100;

                heartBar.style.width = newWidth + '%';
                heartGauge.setAttribute('aria-valuenow', newWidth);
                sliderValueInput.value = newWidth; // hidden input 업데이트
            };

            const onMouseUp = () => {
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
            };

            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
        });
    </script>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const todoContainer = document.querySelector('.todo');

            todoContainer.addEventListener('click', (event) => {
                const myWork = event.target.closest('.my_work');
                if (myWork) {
                    const toggleDiv = myWork.querySelector('.toggle');
                    if (toggleDiv) {
                        if (toggleDiv.classList.contains('com')) {
                            toggleDiv.classList.remove('com');
                            toggleDiv.classList.add('uncom');
                        } else {
                            toggleDiv.classList.remove('uncom');
                            toggleDiv.classList.add('com');
                        }
                    }
                }
            });
        });
    </script>
</body>

</html>